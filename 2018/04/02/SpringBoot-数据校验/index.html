<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>SpringBoot-数据校验 | 黑风雅过吟</title><link rel="stylesheet" type="text/css" href="//fonts.loli.net/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/zzkenyon.github.io/css/style.css?v=2.0.3"><link rel="stylesheet" type="text/css" href="/zzkenyon.github.io/css/highlight.css?v=2.0.3"><link rel="Shortcut Icon" href="/zzkenyon.github.io/favicon.ico"><link rel="bookmark" href="/zzkenyon.github.io/favicon.ico"><link rel="apple-touch-icon" href="/zzkenyon.github.io/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/zzkenyon.github.io/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/zzkenyon.github.io/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">SpringBoot-数据校验</h1><a id="logo" href="/zzkenyon.github.io/.">黑风雅过吟</a><p class="description">不积跬步无以至千里</p></div><div id="nav-menu"><a href="/zzkenyon.github.io/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/zzkenyon.github.io/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/zzkenyon.github.io/about/"><i class="fa fa-user"> 关于</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="搜索"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">SpringBoot-数据校验</h1><div class="post-meta"><a href="/zzkenyon.github.io/2018/04/02/SpringBoot-数据校验/#comments" class="comment-count"></a><p><span class="date">Apr 02, 2018</span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i>点击</i></i></span></p></div><div class="post-content"><p>参数验证是一个常见的问题，无论是前端还是后台，都需对用户输入进行验证，以此来保证系统数据的正确性。对于web来说，有些人可能理所当然的想在前端验证就行了，但这样是非常错误的做法，前端代码对于用户来说是透明的，稍微有点技术的人就可以绕过这个验证，直接提交数据到后台。无论是前端网页提交的接口，还是提供给外部的接口，参数验证随处可见，也是必不可少的。前端做验证只是为了用户体验，比如控制按钮的显示隐藏，单页应用的路由跳转等等。后端才是最终的保障。总之，一切用户的输入都是不可信的。</p>
<h3 id="1、依赖关系"><a href="#1、依赖关系" class="headerlink" title="1、依赖关系"></a>1、依赖关系</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile <span class="string">'org.springframework.boot:spring-boot-starter-validation'</span></span><br></pre></td></tr></table></figure>
<p>该依赖在spring-boot-starter-web中已经引入，如果是springboot Web项目，则不用再单独添加依赖。</p>
<p>springboot的数据绑定和数据校验功能在org.springframework.validation包中，@Validated注解就是在此定义的。</p>
<p>validation包实现参数校验主要通过调用Jakarta.Validation-api.jar包，该jar包定义了一套参数验证的接口，没有具体实现，我们常用的约束注解就是定义在此处。</p>
<p>validation-api的一个实现包就是Hibernate-validator，spring正是使用该实现进行数据校验的。</p>
<h3 id="2、常用约束"><a href="#2、常用约束" class="headerlink" title="2、常用约束"></a>2、常用约束</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Null</span>             			 		 <span class="comment">//被注释的元素必须为 null     </span></span><br><span class="line"><span class="meta">@NotNull</span>       					     <span class="comment">//被注释的元素必须不为 null     </span></span><br><span class="line"><span class="meta">@AssertTrue</span>     					   <span class="comment">//被注释的元素必须为 true     </span></span><br><span class="line"><span class="meta">@AssertFalse</span>    					   <span class="comment">//被注释的元素必须为 false     </span></span><br><span class="line"><span class="meta">@Min</span>(value)     					   <span class="comment">//被注释的元素必须是一个数字，其值必须大于等于指定的最小值     </span></span><br><span class="line"><span class="meta">@Max</span>(value)       					 <span class="comment">//被注释的元素必须是一个数字，其值必须小于等于指定的最大值     </span></span><br><span class="line"><span class="meta">@DecimalMin</span>(value)  				 <span class="comment">//被注释的元素必须是一个数字，其值必须大于等于指定的最小值 </span></span><br><span class="line"><span class="meta">@DecimalMax</span>(value)  				 <span class="comment">//被注释的元素必须是一个数字，其值必须小于等于指定的最大值</span></span><br><span class="line"><span class="meta">@Size</span>(max=, min=)   				 <span class="comment">//被注释的元素的大小必须在指定的范围内     </span></span><br><span class="line"><span class="meta">@Digits</span> (integer, fraction)  <span class="comment">//被注释的元素必须是一个数字，其值必须在可接受的范围内     </span></span><br><span class="line"><span class="meta">@Past</span>                        <span class="comment">//被注释的元素必须是一个过去的日期     </span></span><br><span class="line"><span class="meta">@Future</span>     								 <span class="comment">//被注释的元素必须是一个将来的日期     </span></span><br><span class="line"><span class="meta">@Pattern</span>(regex=,flag=)  		 <span class="comment">//被注释的元素必须符合指定的正则表达式Hibernate Validator附加的constraint     </span></span><br><span class="line"><span class="meta">@NotBlank</span>(message =)   			 <span class="comment">//验证字符串非null，且长度必须大于0     </span></span><br><span class="line"><span class="meta">@Email</span>  										 <span class="comment">//被注释的元素必须是电子邮箱地址     </span></span><br><span class="line"><span class="meta">@Length</span>(min=,max=)  				 <span class="comment">//被注释的字符串的大小必须在指定的范围内     </span></span><br><span class="line"><span class="meta">@NotEmpty</span>   								 <span class="comment">//被注释的字符串的必须非空     </span></span><br><span class="line"><span class="meta">@Range</span>(min=,max=,message=)   <span class="comment">//被注释的元素必须在合适的范围内</span></span><br></pre></td></tr></table></figure>
<h3 id="3、controller层入参校验"><a href="#3、controller层入参校验" class="headerlink" title="3、controller层入参校验"></a>3、controller层入参校验</h3><h4 id="3-1-平铺参数的校验"><a href="#3-1-平铺参数的校验" class="headerlink" title="3.1 平铺参数的校验"></a>3.1 平铺参数的校验</h4><p>controller类上需要注解@Validated，在controller方法入参前添加约束注解，校验方能生效。此外，类上注解@Validated后，方法的返回值也能进行约束。如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoController</span></span>&#123;</span><br><span class="line">  <span class="meta">@GetMapping</span>(<span class="string">"/valid"</span>)</span><br><span class="line">  <span class="keyword">public</span> <span class="meta">@Length</span>(min=<span class="number">4</span>) <span class="function">String <span class="title">test</span><span class="params">(@RequestParam @Email String email)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> email;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>入参校验失败将抛出 javax.validation.<strong>ConstraintViolationException</strong></p>
<p><em>平铺参数校验原理与下文的service层校验一致</em></p>
<p>此外，当GetMapping请求参数过多，开发时我们可能会使用queryVo接收请求参数，Get方法中QueryVo前不能注解@RequestBody 和 @RequestParam，如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/vo_valid"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">queryByVo</span><span class="params">(@Valid OrderItem item)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> item.toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>此处@Valid校验不生效，因为queryVo看上去是一个javaBean，但实际上数据绑定阶段是逐个字段进行绑定的，并没有将其当成是一个javaBean。既然如此，如果去掉@Valid注解，queryVo中的约束注解会生效吗？答案是不生效</p>
<p>此时有两个选择</p>
<ul>
<li>继续选择使用GetMapping方式，queryVo的校验在service层进行</li>
<li>改选PostMapping方式，使用@Valid @RequestBody进行校验</li>
</ul>
<h4 id="3-2-javaBean参数校验"><a href="#3-2-javaBean参数校验" class="headerlink" title="3.2 javaBean参数校验"></a>3.2 javaBean参数校验</h4><p>在bean类中使用注解约束字段:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Order</span></span>&#123;</span><br><span class="line">  	<span class="meta">@NotEmpty</span></span><br><span class="line">  	<span class="keyword">private</span> String oid;</span><br><span class="line">  	<span class="meta">@NotNull</span></span><br><span class="line">  	<span class="keyword">private</span> Date createTime;</span><br><span class="line">  	<span class="meta">@Valid</span></span><br><span class="line">  	<span class="keyword">private</span> List&lt;OrderItem&gt; items;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在方法中需要校验的javaBean参数前注解@Valid/@Validated（可分组）。</p>
<p>校验失败将抛出 org.springframework.web.bind.<strong>MethodArgumentNotValidExption</strong> ，该异常中含有一个BindingResult对象。</p>
<p>spring使用默认异常处理器<strong>DefaultExceptionHandlerResolver</strong>处理该异常，我们可以在controller方法参数列表中增加一个BindingResult对象来接受校验错误信息，然后使用自定义处理器处理。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span>(value = <span class="string">"/demo"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Integer <span class="title">addDemo</span><span class="params">(@Valid @RequestBody Demo demo, BindingResult bindingResult)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(bindingResult.hasErrors())&#123;</span><br><span class="line">      <span class="keyword">for</span>(ObjectError error : bindingResult.getAllErrors())&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> DemoException(DemoExceptionEnum.PARAM_ERROR.getCode(),error.getDefaultMessage());</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> demoService.insert(demo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意：如果在一个方法中有多个javaBean参数需要校验，那么每一个javaBean都需要定义一个BindingResult对象来接收校验结果</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span><span class="params">(@RequestBody @Valid DemoModel demo, BindingResult result)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span><span class="params">(@RequestBody @Valid DemoModel demo, BindingResult result,@RequestBody @Valid DemoModel demo2, BindingResult result2)</span></span></span><br></pre></td></tr></table></figure>
<h4 id="3-3-配置校验模式"><a href="#3-3-配置校验模式" class="headerlink" title="3.3 配置校验模式"></a>3.3 配置校验模式</h4><ul>
<li>默认的校验模式为<strong>普通模式</strong>，普通模式下会校验完所有的属性然后返回所有的校验失败信息</li>
<li>可配置为<strong>快速失败返回模式</strong>，只要有一个属性校验失败则立即返回</li>
</ul>
<p>配置方式:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ValidatorConfiguration</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Validator <span class="title">validator</span><span class="params">()</span></span>&#123;</span><br><span class="line">        ValidatorFactory validatorFactory = Validation.byProvider( HibernateValidator.class )</span><br><span class="line">                .configure()</span><br><span class="line">            　　<span class="comment">/**设置validator模式为快速失败返回*/</span></span><br><span class="line">                .addProperty( <span class="string">"hibernate.validator.fail_fast"</span>, <span class="string">"true"</span> )</span><br><span class="line">                .buildValidatorFactory();</span><br><span class="line">        Validator validator = validatorFactory.getValidator();</span><br><span class="line">        <span class="keyword">return</span> validator;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="4-service层数据校验"><a href="#4-service层数据校验" class="headerlink" title="4. service层数据校验"></a>4. service层数据校验</h3><p>在service接口方法参数类型或返回值类型前注解约束：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Validated</span>(Default.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OrderService</span> </span>&#123;</span><br><span class="line">    <span class="function">Object <span class="title">hello</span><span class="params">(@NotNull @Min(<span class="number">10</span>)</span> Integer id, @NotNull String name)</span>;</span><br><span class="line">    <span class="comment">//平铺参数校验</span></span><br><span class="line">    <span class="function">Order <span class="title">queryById</span><span class="params">(@NumberLength(<span class="string">"4,6,8,10,12"</span>)</span> @<span class="title">Length</span><span class="params">(max=<span class="number">10</span>)</span> String id)</span>;</span><br><span class="line">    <span class="comment">//使用@Valid实现javaBean参数校验</span></span><br><span class="line">    <span class="function">String <span class="title">saveOrder</span><span class="params">(@Valid Order order)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>@Validated(Default.class)也可以注解在接口实现类上面，实现类编写方式无殊。</p>
<p>校验失败抛异常javax.validation.<strong>ConstraintViolationException</strong></p>
<h3 id="5-扩展需求"><a href="#5-扩展需求" class="headerlink" title="5. 扩展需求"></a>5. 扩展需求</h3><h4 id="5-1-分组校验"><a href="#5-1-分组校验" class="headerlink" title="5.1 分组校验"></a>5.1 分组校验</h4><p>分组校验只有使用@Validated注解才能实现</p>
<p>使用场景：针对同一个model类，不同的接口需要对不同的属性进行校验  </p>
<p>例如，数据插入接口与数据更新接口需要校验的参数是不同的</p>
<p>使用方法  </p>
<ol>
<li>在model类中定义内部接口 </li>
<li>约束增加组别属性</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span></span>&#123;</span><br><span class="line">     <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AddGorup</span></span>&#123;&#125;</span><br><span class="line">     <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UpdateGroup</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">     <span class="meta">@Range</span>(min = <span class="number">1</span>,max = Integer.MAX_VALUE,groups = &#123;UpdateGroup.class&#125;)</span><br><span class="line">     <span class="keyword">private</span> Integer id;</span><br><span class="line">     </span><br><span class="line">     <span class="meta">@Email</span>(groups = &#123;AddGroup.class,UpdateGroup.class&#125;)</span><br><span class="line">     <span class="keyword">private</span> String email;</span><br><span class="line">     </span><br><span class="line">     <span class="meta">@Past</span>(groups = &#123;UpdateGroup.class&#125;)</span><br><span class="line">     <span class="keyword">private</span> Date birthday; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>在接口方法或者方法参数上使用@Validated({Demo.AddGroup.class})来注解参数，表示该参数使用AddGroup来进行校验。<br>约束的groups属性中可以填写多个接口名，表示该参数加入多个组进行校验</li>
</ol>
<h4 id="5-2-嵌套校验"><a href="#5-2-嵌套校验" class="headerlink" title="5.2 嵌套校验"></a>5.2 嵌套校验</h4><p>嵌套校验指的是需要校验的javaBean中有的校验成员也是JavaBean类型，此时在成员上面注解@Valid即可实现嵌套校验</p>
<h4 id="5-3-自定义约束校验"><a href="#5-3-自定义约束校验" class="headerlink" title="5.3 自定义约束校验"></a>5.3 自定义约束校验</h4><p>创建约束标注</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target</span>(&#123;ElementType.METHOD,ElementType.ANNOTATION_TYPE,ElementType.FIELD,ElementType.PARAMETER&#125;)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Constraint</span>(validatedBy = DemoConstraintValidator.class)</span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> DemoConstraint &#123;</span><br><span class="line">    <span class="function">String <span class="title">message</span><span class="params">()</span> <span class="keyword">default</span> "<span class="keyword">default</span> message"</span>;</span><br><span class="line">    Class&lt;?&gt;[] groups() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">    Class&lt;? extends Payload&gt;[] payload() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">    <span class="function">E <span class="title">value</span><span class="params">()</span></span>;<span class="comment">//约束中设置的value值</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>实现一个验证器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * A  自定义的约束注解类型</span></span><br><span class="line"><span class="comment"> * T  需要检验的目标参数类型</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoConstraintValidator</span> <span class="keyword">implements</span> <span class="title">ConstraintValidator</span>&lt;<span class="title">A</span>, <span class="title">T</span>&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> T value;<span class="comment">//注入设置的具体约束</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initialize</span><span class="params">(A a)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.value = a.value();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isValid</span><span class="params">(T t, ConstraintValidatorContext constraintValidatorContext)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//根据value 对 参数t 进行一些判断</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">if</span>(!isValid) &#123;</span><br><span class="line">            constraintContext.disableDefaultConstraintViolation();</span><br><span class="line">            constraintContext.buildConstraintViolationWithTemplate(<span class="string">"new default message"</span>).addConstraintViolation();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>A表示创建的注解，T表示该约束校验的数据类型</p>
<p>定义默认的验证错误信息，可以通过ConstraintValidatorContext修改默认的message信息，一旦使用，在注解中给message赋值将不起作用（一般情况下不推荐使用）</p>
<h4 id="5-4-检验组序列"><a href="#5-4-检验组序列" class="headerlink" title="5.4 检验组序列"></a>5.4 检验组序列</h4><p>默认情况下，约束的计算没有特定的顺序，这与它们属于哪个组无关。然而，在某些情况下，控制约束求值的顺序是有用的，例如，我们可以要求在检查汽车的道路价值之前，首先通过所有默认的汽车约束。最后，在我们开车离开之前，我们检查了实际司机的约束条件。为了实现这样的顺序，需要定义一个新的接口，并使用@GroupSequence对其进行注释，以定义必须验证组的顺序。</p>
<p>注意：<br>如果这个校验组序列中有一个约束条件没有通过验证的话, 那么此约束条件后面的都不会再继续被校验了.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GroupSequence</span>(&#123;Default.class, CarChecks.class, DriverChecks.class&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OrderedChecks</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="6-总结"><a href="#6-总结" class="headerlink" title="6. 总结"></a>6. 总结</h3><p>@Validated 和 @Valid  </p>
<ul>
<li>Java Bean中的嵌套校验只能用@Valid</li>
<li>在controller方法中校验@RequestBody参数，参数前注解@Valid和@Validated都行，但如果要使用分组校验功能，只能使用后者</li>
<li>controller中校验平铺型@RequestParam参数，需要在controller类前注解@Validated，参数前注解约束规则</li>
<li>service层校验统一在service接口类上注解@Validated，接口方法参数列表中注解约束（类型参数前可以注解@Valid），实现类中不涉及验证相关代码</li>
</ul>
<p>参考：<br><a href="http://docs.jboss.org/hibernate/validator/4.2/reference/zh-CN/html_single/#preface" target="_blank" rel="noopener">官方文档</a><br><a href="https://www.cnblogs.com/mr-yang-localhost/p/7812038.html" target="_blank" rel="noopener">springboot使用hibernate validator校验</a><br><a href="https://blog.csdn.net/qq_27680317/article/details/79970590" target="_blank" rel="noopener">@Validated和@Valid区别</a></p>
</div><div class="post-copyright"><blockquote><p>原文作者: Zhao Zhengkang</p><p>原文链接: <a href="http://yoursite.com/child/2018/04/02/SpringBoot-数据校验/">http://yoursite.com/child/2018/04/02/SpringBoot-数据校验/</a></p><p>版权声明: 转载请注明出处(必须保留作者署名及链接)</p></blockquote></div><div class="tags"><a href="/zzkenyon.github.io/tags/SpringBoot/">SpringBoot</a></div><div class="post-share"><div class="social-share"><span>分享到:</span></div></div><div class="post-nav"><a href="/zzkenyon.github.io/2018/04/19/并发编程-独占式AQS源码详解/" class="pre">并发编程-独占式AQS源码详解</a><a href="/zzkenyon.github.io/2018/04/01/并发编程-锁/" class="next">并发编程-锁</a></div><div id="comments"></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1、依赖关系"><span class="toc-text">1、依赖关系</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2、常用约束"><span class="toc-text">2、常用约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3、controller层入参校验"><span class="toc-text">3、controller层入参校验</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-平铺参数的校验"><span class="toc-text">3.1 平铺参数的校验</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-javaBean参数校验"><span class="toc-text">3.2 javaBean参数校验</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-配置校验模式"><span class="toc-text">3.3 配置校验模式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-service层数据校验"><span class="toc-text">4. service层数据校验</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-扩展需求"><span class="toc-text">5. 扩展需求</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-分组校验"><span class="toc-text">5.1 分组校验</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-嵌套校验"><span class="toc-text">5.2 嵌套校验</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-自定义约束校验"><span class="toc-text">5.3 自定义约束校验</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-4-检验组序列"><span class="toc-text">5.4 检验组序列</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-总结"><span class="toc-text">6. 总结</span></a></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/zzkenyon.github.io/2020/04/26/nio-epoll高效运行原理/">nio-epoll高效运行原理</a></li><li class="post-list-item"><a class="post-list-link" href="/zzkenyon.github.io/2020/04/14/其他-CSRF攻击与防御/">CSRF攻击与防御（转）</a></li><li class="post-list-item"><a class="post-list-link" href="/zzkenyon.github.io/2020/04/07/分布式-日志上传es/">ELK日志系统</a></li><li class="post-list-item"><a class="post-list-link" href="/zzkenyon.github.io/2020/01/02/SpringCloud-服务注册、调用以及负载均衡/">SpringCloud-服务注册、调用以及负载均衡</a></li><li class="post-list-item"><a class="post-list-link" href="/zzkenyon.github.io/2020/01/02/redis-热点key问题/">redis-热key问题</a></li><li class="post-list-item"><a class="post-list-link" href="/zzkenyon.github.io/2020/01/02/mysql-innoDB架构分析/">mysql-innoDB架构分析</a></li><li class="post-list-item"><a class="post-list-link" href="/zzkenyon.github.io/2020/01/02/mysql-redo log写流程分析/">mysql-redo log写流程分析(转)</a></li><li class="post-list-item"><a class="post-list-link" href="/zzkenyon.github.io/2019/12/31/jvm-对象的内存布局/">jvm-对象的内存布局</a></li><li class="post-list-item"><a class="post-list-link" href="/zzkenyon.github.io/2019/12/31/redis-集群搭建/">reids-5.0版本的高可用集群搭建</a></li><li class="post-list-item"><a class="post-list-link" href="/zzkenyon.github.io/2019/12/19/nio-说说零拷贝/">nio-说说零拷贝</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/zzkenyon.github.io/tags/java/" style="font-size: 15px;">java</a> <a href="/zzkenyon.github.io/tags/MQ/" style="font-size: 15px;">MQ</a> <a href="/zzkenyon.github.io/tags/SpringBoot/" style="font-size: 15px;">SpringBoot</a> <a href="/zzkenyon.github.io/tags/其他/" style="font-size: 15px;">其他</a> <a href="/zzkenyon.github.io/tags/linux命令/" style="font-size: 15px;">linux命令</a> <a href="/zzkenyon.github.io/tags/nginx/" style="font-size: 15px;">nginx</a> <a href="/zzkenyon.github.io/tags/redis/" style="font-size: 15px;">redis</a> <a href="/zzkenyon.github.io/tags/分布式/" style="font-size: 15px;">分布式</a> <a href="/zzkenyon.github.io/tags/并发编程/" style="font-size: 15px;">并发编程</a> <a href="/zzkenyon.github.io/tags/数据库/" style="font-size: 15px;">数据库</a> <a href="/zzkenyon.github.io/tags/设计模式/" style="font-size: 15px;">设计模式</a> <a href="/zzkenyon.github.io/tags/JVM/" style="font-size: 15px;">JVM</a> <a href="/zzkenyon.github.io/tags/nio/" style="font-size: 15px;">nio</a> <a href="/zzkenyon.github.io/tags/SpringCloud/" style="font-size: 15px;">SpringCloud</a> <a href="/zzkenyon.github.io/tags/web/" style="font-size: 15px;">web</a> <a href="/zzkenyon.github.io/tags/jdk/" style="font-size: 15px;">jdk</a> <a href="/zzkenyon.github.io/tags/日志/" style="font-size: 15px;">日志</a> <a href="/zzkenyon.github.io/tags/Mybatis/" style="font-size: 15px;">Mybatis</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/zzkenyon.github.io/archives/2020/04/">四月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/zzkenyon.github.io/archives/2020/01/">一月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/zzkenyon.github.io/archives/2019/12/">十二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/zzkenyon.github.io/archives/2019/11/">十一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/zzkenyon.github.io/archives/2019/10/">十月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/zzkenyon.github.io/archives/2019/09/">九月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/zzkenyon.github.io/archives/2019/08/">八月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/zzkenyon.github.io/archives/2019/07/">七月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/zzkenyon.github.io/archives/2019/06/">六月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/zzkenyon.github.io/archives/2019/05/">五月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/zzkenyon.github.io/archives/2018/10/">十月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/zzkenyon.github.io/archives/2018/08/">八月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/zzkenyon.github.io/archives/2018/07/">七月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/zzkenyon.github.io/archives/2018/05/">五月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/zzkenyon.github.io/archives/2018/04/">四月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/zzkenyon.github.io/archives/2018/03/">三月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/zzkenyon.github.io/archives/2018/02/">二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/zzkenyon.github.io/archives/2018/01/">一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/zzkenyon.github.io/archives/2017/12/">十二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/zzkenyon.github.io/archives/2017/05/">五月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/zzkenyon.github.io/archives/2017/04/">四月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/zzkenyon.github.io/archives/2017/03/">三月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/zzkenyon.github.io/archives/2016/12/">十二月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/zzkenyon.github.io/archives/2016/08/">八月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/zzkenyon.github.io/archives/2016/07/">七月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/zzkenyon.github.io/archives/2016/05/">五月 2016</a></li></ul></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/zzkenyon.github.io/baidusitemap.xml">网站地图</a> |  <a href="/zzkenyon.github.io/atom.xml">订阅本站</a> |  <a href="/zzkenyon.github.io/about/">联系博主</a></p><p>本站总访问量：<i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>次，本站总访客数:<i id="busuanzi_container_site_uv"><i id="busuanzi_value_site_uv"></i></i>人</p><p><span> Copyright &copy;<a href="/zzkenyon.github.io/." rel="nofollow">Zhao Zhengkang.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Count by<a href="http://busuanzi.ibruce.info/"> busuanzi.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script type="text/javascript" src="/zzkenyon.github.io/js/search.json.js?v=2.0.3"></script><script type="text/javascript" src="/zzkenyon.github.io/js/toctotop.js?v=2.0.3" async></script><link rel="stylesheet" type="text/css" href="/zzkenyon.github.io/share/css/share.css"><script type="text/javascript" src="/zzkenyon.github.io/share/js/social-share.js" charset="utf-8"></script><script type="text/javascript" src="/zzkenyon.github.io/share/js/qrcode.js" charset="utf-8"></script></body></html>