<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>nio-I/O模型 | 黑风雅过吟</title><link rel="stylesheet" type="text/css" href="//fonts.loli.net/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/zzkenyon.github.io/css/style.css?v=2.0.3"><link rel="stylesheet" type="text/css" href="/zzkenyon.github.io/css/highlight.css?v=2.0.3"><link rel="Shortcut Icon" href="/zzkenyon.github.io/favicon.ico"><link rel="bookmark" href="/zzkenyon.github.io/favicon.ico"><link rel="apple-touch-icon" href="/zzkenyon.github.io/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/zzkenyon.github.io/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/zzkenyon.github.io/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">nio-I/O模型</h1><a id="logo" href="/zzkenyon.github.io/.">黑风雅过吟</a><p class="description">不积跬步无以至千里</p></div><div id="nav-menu"><a href="/zzkenyon.github.io/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/zzkenyon.github.io/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/zzkenyon.github.io/about/"><i class="fa fa-user"> 关于</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="搜索"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">nio-I/O模型</h1><div class="post-meta"><a href="/zzkenyon.github.io/2019/05/20/nio-IO模型/#comments" class="comment-count"></a><p><span class="date">May 20, 2019</span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i>点击</i></i></span></p></div><div class="post-content"><p>上一篇我们讲到了关于TCP/IP协议的一些内容，这些是网络编程的必备知识。在了解NIO之前我们必须要了解一下对应的系统层IO模型，比如java的NIO对应是那种IO模型，阻塞和同步的差异在哪里，又是否相同。了解了这些更方便我们的后续的NIO探解。</p>
<h3 id="1-同步-异步、阻塞-非阻塞"><a href="#1-同步-异步、阻塞-非阻塞" class="headerlink" title="1. 同步/异步、阻塞/非阻塞"></a>1. 同步/异步、阻塞/非阻塞</h3><p>同步、异步，阻塞、非阻塞，这四种状态常有人分不清，主要是这四种状态的定义本身也不是很明确，所以各种解答的方式都有。常见的分类有以下:</p>
<ul>
<li>同步阻塞IO</li>
<li>同步非阻塞IO</li>
<li>异步非阻塞IO   </li>
</ul>
<p>阻塞是指执行I/O操作的线程，在I/O操作过程中能不能处理其他任务。同步指I/O操作过程中的消息通知机制。</p>
<p>同步：是否同步体现在消息通信机制上。</p>
<h4 id="1-1-如何分类"><a href="#1-1-如何分类" class="headerlink" title="1.1 如何分类"></a>1.1 如何分类</h4><p>针对某种IO模型，我们如何分类，可以基于POSIX对同步/异步的定义来判别：同步的I/O操作会导致请求进程阻塞，直到I/O操作完成；而异步的I/O操做则不会引起请求进程阻塞。</p>
<p>如果说以上的定义依然无法判别，我们可以从输入操作的两个阶段来看：</p>
<p>一般来说，一个输入操作通常包括两个不同阶段：</p>
<blockquote>
<p>（1）等待数据准备好；</p>
<p>（2）从内核向进程复制数据。</p>
</blockquote>
<p>是否同步的判断依据是：针对整个过程，也就是2个阶段，是否有阻塞。</p>
<p>是否阻塞的判断依据是：按程序（线程）等待消息通知时的状态角度来说的，也就是主要是针对第一阶段来说。</p>
<h4 id="1-2-举例说明"><a href="#1-2-举例说明" class="headerlink" title="1.2 举例说明"></a>1.2 举例说明</h4><p>我们举例来说：比如说做饭这件事，一般要分为连个步骤。</p>
<p>1、买菜，准备食材</p>
<p>2、炒菜，做出饭菜 </p>
<p><strong>方案一：自己动手。</strong></p>
<blockquote>
<p>1、去超市买菜，准备食材（阻塞，当前时段只能做一件事，且需要持续的等待）</p>
<p>2、回家切菜，炒菜，做饭菜（阻塞，还是自己来处理）</p>
</blockquote>
<p> 方案一同步阻塞。首先阶段一是阻塞的，所以认定为阻塞；两个阶段都是阻塞的，认定为同步的。</p>
<p><strong>方案二：网购食材，自己做饭</strong></p>
<blockquote>
<p>1、网上下单，配送食材。（非阻塞的，这期间你可以干其他事）</p>
<p>2、拿到菜，切菜、炒菜，做饭菜（阻塞）</p>
</blockquote>
<p>方案二为同步非阻塞。阶段一为非阻塞，认定为非阻塞。阶段二为阻塞，两阶段中有一个为阻塞，认定为同步。</p>
<p><strong>方案三：网购食材，请人做饭</strong></p>
<blockquote>
<p>1、网上下单，配送食材。（非阻塞的，这期间你可以干其他事）</p>
<p>2、请小时工，帮忙做这一餐，做好通知我。（非阻塞，期间可以干其他事）</p>
</blockquote>
<p>方案三为异步非阻塞。阶段一为非阻塞，认定为非阻塞。阶段二非阻塞，则两阶段中都没有阻塞，认定为异步。</p>
<p>那么是否有异步阻塞IO模型，没有，要记得异步状态是包含二个阶段的，如果有阻塞的过程，为何还叫异步？</p>
<h3 id="2-Unix-5种I-O模型"><a href="#2-Unix-5种I-O模型" class="headerlink" title="2. Unix 5种I/O模型"></a>2. Unix 5种I/O模型</h3><p>在<a href="https://link.zhihu.com/?target=http%3A//book.douban.com/subject/1500149/" target="_blank" rel="noopener">《UNIX网络编程：卷一》</a>的第六章书中列出了五种IO模型：</p>
<ul>
<li>阻塞式I/O</li>
<li>非阻塞式I/O</li>
<li>I/O复用（select，poll，epoll…）</li>
<li>信号驱动式I/O（SIGIO）</li>
<li>异步I/O（POSIX的aio_系列函数）</li>
</ul>
<h4 id="2-1-阻塞式I-O"><a href="#2-1-阻塞式I-O" class="headerlink" title="2.1 阻塞式I/O"></a>2.1 阻塞式I/O</h4><p>同步阻塞 IO 模型是最常用的一个模型，也是最简单的模型。在linux中，<code>默认情况下所有的socket都是blocking</code>。它符合人们最常见的思考逻辑。</p>
<p>在这个IO模型中，用户空间的应用程序执行一个系统调用（recvform），这会导致应用程序阻塞，什么也不干，直到数据准备好，等待kernel准备好从网络上接收到的数据报 + 等待收到的报文被从kernel复制到buf中，recvfrom方法才会返回，最后进程再处理数据。</p>
<p>这就是阻塞式IO模型</p>
<p><img src="http://wx1.sinaimg.cn/large/87c9e458ly1g48qy5z7m7j20ww0hygqd.jpg" alt="阻塞式I/O"></p>
<h4 id="2-2-非阻塞式I-O"><a href="#2-2-非阻塞式I-O" class="headerlink" title="2.2 非阻塞式I/O"></a>2.2 非阻塞式I/O</h4><p>非阻塞IO时对一个非阻塞描述符循环调用recvfrom，持续的轮询（polling）,以查看某个操作是否就绪。与阻塞IO不一样，”非阻塞将大的整片时间的阻塞分成N多的小的阻塞, 所以进程不断地有机会 ‘被’ CPU光顾”。</p>
<p>非阻塞的recvform系统调用调用之后，进程并没有被阻塞，内核马上返回给进程，如果数据还没准备好，此时会返回一个error。进程在返回之后，可以干点别的事情，然后再发起recvform系统调用。如此循环的进行recvform系统调用，检查内核数据，直到数据准备好，再拷贝数据到进程。<strong>拷贝数据整个过程，进程仍然是属于阻塞的状态</strong>。</p>
<p>这就是非阻塞式IO模型</p>
<p><img src="http://wx4.sinaimg.cn/large/87c9e458ly1g48r29sz64j20wg0hqtfg.jpg" alt="非阻塞式    i/o"></p>
<h4 id="2-3-I-O复用"><a href="#2-3-I-O复用" class="headerlink" title="2.3 I/O复用"></a>2.3 I/O复用</h4><p>IO multiplexing就是我们说的select，poll，epoll 。为何叫多路复用，是因为它I/O多路复用可以同时监听多个fd，如此就减少了为每个需要监听的fd开启线程的开销。</p>
<p>select调用是内核级别的，可以等待多个socket，能实现同时对多个IO端口进行监听<code>，当其中任何一个socket的数据准好了，</code>就能返回进行可读<code>，</code>然后进程再进行recvform系统调用，将数据由内核拷贝到用户进程，这个过程是阻塞的。</p>
<p>I/O复用模型会用到select、poll、epoll函数，这几个函数也会使进程阻塞，但是和阻塞I/O所不同的的，这几个函数可以同时阻塞多个I/O操作`。而且可以同时对多个读操作，多个写操作的I/O函数进行检测，直到有数据可读或可写时（不是等到socket数据全部到达再处理, 而是有了一部分数据就会调用用户进程来处理），才真正调用I/O操作函数。</p>
<p>IO复用有人把其成为同步非阻塞的，也有称为同步阻塞。其实这个是否阻塞还需要看第一个阶段，第一个阶段有的阻塞，有的不阻塞。主要也是阻塞在select阶段，属于用户主动等待阶段，我们且规范为阻塞状态，所以，<code>把IO多路复用归为同步阻塞模式</code>。</p>
<p>这是IO复用的模型:</p>
<p><img src="http://wx1.sinaimg.cn/large/87c9e458ly1g48r4580pyj20vc0gc0z0.jpg" alt></p>
<p>select、poll、epoll的不同</p>
<p><img src="http://wx3.sinaimg.cn/large/87c9e458ly1g48r54j7btj20wi0giace.jpg" alt="img"></p>
<h4 id="2-4-信号驱动式I-O"><a href="#2-4-信号驱动式I-O" class="headerlink" title="2.4 信号驱动式I/O"></a>2.4 信号驱动式I/O</h4><p>信号驱动式I/O：首先我们允许Socket进行信号驱动IO,并安装一个信号处理函数，进程继续运行并不阻塞。当数据准备好时，进程会收到一个SIGIO信号，可以在信号处理函数中调用I/O操作函数处理数据。</p>
<p>也就是说第一个阶段，完全是非阻塞的，等数据到达会给一个信号通知，第二个阶段recvfrom还是阻塞过程，和之上无差异。</p>
<p>信号驱动式I/O 过程如下:</p>
<p><img src="http://wx2.sinaimg.cn/large/87c9e458ly1g48r5ivr4qj20x40l2wj2.jpg" alt></p>
<h4 id="2-5-异步I-O"><a href="#2-5-异步I-O" class="headerlink" title="2.5 异步I/O"></a>2.5 异步I/O</h4><p>异步IO不是顺序执行,用户进程进行aio_read系统调用之后，无论内核数据是否准备好，都会直接返回给用户进程，然后用户态进程可以去做别的事情。等到socket数据准备好了，内核直接复制数据给进程，<code>然后从内核向进程发送通知</code>。<code>IO两个阶段，进程都是非阻塞的</code>。</p>
<p><img src="http://wx1.sinaimg.cn/large/87c9e458ly1g48r6uzcajj20wo0kkn1r.jpg" alt></p>
<h4 id="2-6-总结"><a href="#2-6-总结" class="headerlink" title="2.6 总结"></a>2.6 总结</h4><p>针对这5中IO模型，我采用一张图来总结一下。</p>
<p><img src="http://wx1.sinaimg.cn/large/87c9e458ly1g48r6zq1p4j20zg0mq49j.jpg" alt></p>
<h3 id="3-java-IO"><a href="#3-java-IO" class="headerlink" title="3. java IO"></a>3. java IO</h3><p>Unix中的五种I/O模型，除信号驱动I/O外，Java对其它四种I/O模型都有所支持。其中Java最早提供的blocking I/O即是同步阻塞I/O，而NIO即是同步非阻塞I/O，同时通过NIO实现的Reactor模式即是I/O复用模型的实现，通过AIO实现的Proactor模式即是异步I/O模型的实现。</p>
<p>所以说严格意义上来说，通过Reactor模式实现的NIO，和unix中的I/O多路复用是相同的概念，但这是一种编程模型，而不是原生支持。这也是我们下面所要进行的netty讲解的主要思想。</p>
</div><div class="post-copyright"><blockquote><p>原文作者: Zhao Zhengkang</p><p>原文链接: <a href="http://yoursite.com/child/2019/05/20/nio-IO模型/">http://yoursite.com/child/2019/05/20/nio-IO模型/</a></p><p>版权声明: 转载请注明出处(必须保留作者署名及链接)</p></blockquote></div><div class="tags"><a href="/zzkenyon.github.io/tags/nio/">nio</a></div><div class="post-share"><div class="social-share"><span>分享到:</span></div></div><div class="post-nav"><a href="/zzkenyon.github.io/2019/05/26/nio-入门篇-应用案例讲解/" class="pre">nio-入门篇-应用案例讲解</a><a href="/zzkenyon.github.io/2018/10/24/SpringBoot-注解@ConfigurationProperties的正确使用姿势/" class="next">SpringBoot-注解@ConfigurationProperties的正确使用姿势</a></div><div id="comments"></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-同步-异步、阻塞-非阻塞"><span class="toc-text">1. 同步/异步、阻塞/非阻塞</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-如何分类"><span class="toc-text">1.1 如何分类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-举例说明"><span class="toc-text">1.2 举例说明</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Unix-5种I-O模型"><span class="toc-text">2. Unix 5种I/O模型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-阻塞式I-O"><span class="toc-text">2.1 阻塞式I/O</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-非阻塞式I-O"><span class="toc-text">2.2 非阻塞式I/O</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-I-O复用"><span class="toc-text">2.3 I/O复用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-信号驱动式I-O"><span class="toc-text">2.4 信号驱动式I/O</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5-异步I-O"><span class="toc-text">2.5 异步I/O</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-6-总结"><span class="toc-text">2.6 总结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-java-IO"><span class="toc-text">3. java IO</span></a></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/zzkenyon.github.io/2019/11/06/JVM-元空间/">JVM-元空间</a></li><li class="post-list-item"><a class="post-list-link" href="/zzkenyon.github.io/2019/10/23/git-规范的Commit Message/">git-规范的commit message（转）</a></li><li class="post-list-item"><a class="post-list-link" href="/zzkenyon.github.io/2019/09/02/reids-总结精讲/">redis-总结精讲</a></li><li class="post-list-item"><a class="post-list-link" href="/zzkenyon.github.io/2019/09/02/redis-缓存数据库双写一致性/">redis-缓存数据库双写一致性方案解析</a></li><li class="post-list-item"><a class="post-list-link" href="/zzkenyon.github.io/2019/08/02/redis-键空间通知/">redis-键空间通知</a></li><li class="post-list-item"><a class="post-list-link" href="/zzkenyon.github.io/2019/08/01/redis-数据持久化配置/">redis-数据持久化配置</a></li><li class="post-list-item"><a class="post-list-link" href="/zzkenyon.github.io/2019/07/31/数据库-centos安装配置MySql8.0/">数据库-centos安装配置MySql8.0</a></li><li class="post-list-item"><a class="post-list-link" href="/zzkenyon.github.io/2019/06/21/MQ-为什么用和什么时候用/">MQ-为什么用和什么时候用（转）</a></li><li class="post-list-item"><a class="post-list-link" href="/zzkenyon.github.io/2019/05/26/nio-入门篇-应用案例讲解/">nio-入门篇-应用案例讲解</a></li><li class="post-list-item"><a class="post-list-link" href="/zzkenyon.github.io/2019/05/20/nio-IO模型/">nio-I/O模型</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/zzkenyon.github.io/tags/linux命令/" style="font-size: 15px;">linux命令</a> <a href="/zzkenyon.github.io/tags/redis/" style="font-size: 15px;">redis</a> <a href="/zzkenyon.github.io/tags/nginx/" style="font-size: 15px;">nginx</a> <a href="/zzkenyon.github.io/tags/并发编程/" style="font-size: 15px;">并发编程</a> <a href="/zzkenyon.github.io/tags/数据库/" style="font-size: 15px;">数据库</a> <a href="/zzkenyon.github.io/tags/框架/" style="font-size: 15px;">框架</a> <a href="/zzkenyon.github.io/tags/设计模式/" style="font-size: 15px;">设计模式</a> <a href="/zzkenyon.github.io/tags/nio/" style="font-size: 15px;">nio</a> <a href="/zzkenyon.github.io/tags/MQ/" style="font-size: 15px;">MQ</a> <a href="/zzkenyon.github.io/tags/其他/" style="font-size: 15px;">其他</a> <a href="/zzkenyon.github.io/tags/JVM/" style="font-size: 15px;">JVM</a> <a href="/zzkenyon.github.io/tags/SpringBoot/" style="font-size: 15px;">SpringBoot</a> <a href="/zzkenyon.github.io/tags/java/" style="font-size: 15px;">java</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/zzkenyon.github.io/archives/2019/11/">十一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/zzkenyon.github.io/archives/2019/10/">十月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/zzkenyon.github.io/archives/2019/09/">九月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/zzkenyon.github.io/archives/2019/08/">八月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/zzkenyon.github.io/archives/2019/07/">七月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/zzkenyon.github.io/archives/2019/06/">六月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/zzkenyon.github.io/archives/2019/05/">五月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/zzkenyon.github.io/archives/2018/10/">十月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/zzkenyon.github.io/archives/2018/08/">八月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/zzkenyon.github.io/archives/2018/07/">七月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/zzkenyon.github.io/archives/2018/05/">五月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/zzkenyon.github.io/archives/2018/04/">四月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/zzkenyon.github.io/archives/2018/03/">三月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/zzkenyon.github.io/archives/2017/12/">十二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/zzkenyon.github.io/archives/2017/05/">五月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/zzkenyon.github.io/archives/2017/04/">四月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/zzkenyon.github.io/archives/2017/03/">三月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/zzkenyon.github.io/archives/2016/12/">十二月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/zzkenyon.github.io/archives/2016/08/">八月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/zzkenyon.github.io/archives/2016/07/">七月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/zzkenyon.github.io/archives/2016/05/">五月 2016</a></li></ul></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/zzkenyon.github.io/baidusitemap.xml">网站地图</a> |  <a href="/zzkenyon.github.io/atom.xml">订阅本站</a> |  <a href="/zzkenyon.github.io/about/">联系博主</a></p><p>本站总访问量：<i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>次，本站总访客数:<i id="busuanzi_container_site_uv"><i id="busuanzi_value_site_uv"></i></i>人</p><p><span> Copyright &copy;<a href="/zzkenyon.github.io/." rel="nofollow">Zhao Zhengkang.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Count by<a href="http://busuanzi.ibruce.info/"> busuanzi.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script type="text/javascript" src="/zzkenyon.github.io/js/search.json.js?v=2.0.3"></script><script type="text/javascript" src="/zzkenyon.github.io/js/toctotop.js?v=2.0.3" async></script><link rel="stylesheet" type="text/css" href="/zzkenyon.github.io/share/css/share.css"><script type="text/javascript" src="/zzkenyon.github.io/share/js/social-share.js" charset="utf-8"></script><script type="text/javascript" src="/zzkenyon.github.io/share/js/qrcode.js" charset="utf-8"></script></body></html>